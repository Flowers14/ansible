---
- name: Create a VM from a template
  hosts: 127.0.0.1

  vars:
    datacenter: 'florian.paris'
    esxi_host: '192.168.17.10'
    notes: 'Created by Florian PARIS'
    vcenter_hostname: 192.168.17.20
    vcenter_user: root
    vcenter_pass: Florian2015!
    datastore: /florian.paris/esxi/datastore1/
    network: VM Network
    memory: 10
    cpucount: 1
    osid: debin6_64Guest
    
    
    - name: Gather facts from standalone ESXi server having datacenter as 'ha-datacenter'
      vmware_datastore_facts:
        hostname: 192.168.17.20
        username: root
        password: Florian2015!
        datacenter: florian.paris
        validate_certs: no
      delegate_to: localhost
      register: facts
    
    
    

  tasks:
  - name: Create a VM from template
    vmware_guest:
      hostname: 192.168.17.10
      username: root
      password: Espoir15
      validate_certs: no
      folder: florian.paris/esxi/datastore1/toto/
      name: florian.parisVM
      state: present
      template: vm1
      disk:
      - size_gb: 1
        type: thin
        datastore: florian.paris/esxi/datastore1/esxiVM/
      hardware:
        memory_mb: 512
        num_cpus: 1
        scsi: paravirtual
#      networks:
#      - name: 'VM Network'
#        mac: aa:bb:dd:aa:00:14
      wait_for_ip_address: yes
#    delegate_to: localhost
    register: deploy
